!function(b){b.fn.uploadify=function(e){var i={fileTypeExts:"",uploader:"",auto:!1,method:"post",multi:!1,formData:{},fileObjName:"filedata",fileSizeLimit:2048,showUploadedPercent:!0,showUploadedSize:!1,buttonText:"",removeTimeout:1e3,itemTemplate:'<div id="${fileID}" class="uploadify-queue-item "><div class="uploadify-progress"><div class="uploadify-progress-bar"></div></div><span class="up_filename">${fileName}</span><span class="uploadbtn">上传</span><span class="delfilebtn">删除</span></div>',breakPoints:!1,isBurst:!0,fileSplitSize:1048576,getFileSizeUrl:"",isCn:!0,getUploadedSize:function l(e){var i=0;return b.ajax({url:g.getFileSizeUrl,async:!1,type:"post",dataType:"json",data:{fileMd5:e.md5,fileSplitSize:g.fileSplitSize,fileName:e.name,totalSize:e.size},success:function t(e){e.success?i=e.size:(i=-1,Fai.ing(e.msg))}}),i},saveUploadedSize:null,saveInfoLocal:!1,onUploadStart:null,onUploadSuccess:null,onUploadComplete:null,onUploadError:null,onInit:null,onCancel:null,onSelect:null},g=b.extend(i,e),n=(function a(e){g.uploader=e},function o(e,i){return 1048576<e&&!i?(Math.round(100*e/1048576)/100).toString()+"MB":(Math.round(100*e/1024)/100).toString()+"KB"},function n(e,i){for(var t=0;t<i.length;t++)if(i[t].index==e)return i[t];return!1}),u=function u(e){for(var i=[],t=e.split(";"),l=0,n=t.length;l<n;l++)i.push(t[l].split(".").pop());return i},t={zip:["application/x-zip-compressed"],jpg:["image/jpg"],jpeg:["image/jpeg"],png:["image/png"],gif:["image/gif"],bmp:["image/bmp"],doc:["application/msword"],xls:["application/vnd.ms-excel"],docx:["application/vnd.openxmlformats-officedocument.wordprocessingml.document"],xlsx:["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],ppt:["application/vnd.ms-powerpoint "],pptx:["application/vnd.openxmlformats-officedocument.presentationml.presentation"],mp3:["audio/mp3"],mp4:["video/mp4"],pdf:["application/pdf"],exe:["application/x-msdownload"],html:["text/html"],ico:["image/x-icon"],txt:["text/plain"],flv:[".flv"],swf:["application/x-shockwave-flash"],p12:["application/x-pkcs12"]},s=function s(e){return t[e]},v=function v(e){for(var i=u(e),t=[],l=0,n=i.length;l<n;l++){var a=s(i[l]);a&&t.push(a)}return t.join(",")},h=function h(e,i,t,l){i.open(g.method,e,!0),i.setRequestHeader("X-Requested-With","XMLHttpRequest");var n=new FormData;if(n.append(g.fileObjName,t,t.name),l)for(key in l)n.append(key,l[key]);i.send(n)},x=90;function S(e){if("start"==e.status){var i=['<div id="progressBody_'+e.id+'" class="bodyDisable"></div>','<div id="progressWrap_'+e.id+'" class="bodyProgressWrap">','<div class="progressCenter"></div>','<div class="progressIngBody">','<div id="progressTitle'+e.id+'" class="progressIngTitle">'+e.title+"</div>",'<div class="progressIngMission">','<div class="mission"><div id="progress'+e.id+'" class="progress" style="width:1%;"></div></div>','<div id="progressNum'+e.id+'" class="progressNum">0%</div>',"</div>",'<div class="progressInfo"><span class="progressFileSize">文件大小:'+Fai.parseFileSize(e.size)+'</span><a class="progressCancel" href="javascript:uploadCancel(\''+e.id+"');\">取消</a></div>","</div>","</div>"];b("body").append(i.join("")),x=90}else if("ing"==e.status){var t=e.percent;b("#progressTitle"+e.id).text(e.title);var l=F.fileFilter[0].name,n=u(l)[0].toLowerCase(),a=null==s(n)?"":s(n)[0];if(e.percent>x&&100!=e.percent){var o=Math.random()/5;x+=parseFloat(o.toFixed(2)),t=x=parseFloat(x.toFixed(2))}0<=a.indexOf("image")?(b("#progress"+e.id).css("width",t+"%"),b("#progressNum"+e.id).html(t+"%")):(b("#progress"+e.id).css("width",e.percent+"%"),b("#progressNum"+e.id).html(e.percent+"%")),b("#progress"+e.id).attr("width",e.percent),0<=a.indexOf("image")&&99<e.percent&&r(e.id)}else"end"==e.status?(b("#progressTitle"+e.id).text(e.title),b("#progressBody_"+e.id).remove(),b("#progressWrap_"+e.id).remove()):"error"==e.status&&b("#progress"+e.id).addClass("progressError")}function r(e){90!=x&&(100<(x+=.5)||(x=parseFloat(x.toFixed(2)),b("#progress"+e).css("width",x+"%"),b("#progressNum"+e).html(x+"%"),setTimeout(function(){r(e)},1e3)))}function z(e,i){return-1!==e.indexOf(i,e.length-i.length)}var F=null;function y(e){var i=g.uploader;for(key in e)i+="&"+key+"="+e[key];F.url=i}return this.each(function(){var e=b(this),c=b(".uploadify").length+1,i='<a id="file_upload_'+c+'-button" href="javascript:void(0)" class="uploadify-button '+(g.isCn?"":"uploadify-buttonLan")+'">';i+=g.buttonText,i+="</a>",i+='<input id="select_btn_'+c+'" class="selectbtn" style="visibility:hidden;width:72px;" type="file" name="fileselect[]"',i+=g.multi?" multiple":"",i+=' accept="',null==g.fileTypeExts||""==g.fileTypeExts||"*"==g.fileTypeExts||"*.*;"==g.fileTypeExts?i+="*.*":i+=v(g.fileTypeExts),i+='"/>';e.append(i),(F={xhr:null,uploadAllowed:!0,fileInput:e.find(".selectbtn"),uploadFileList:b(document).find(".uploadify-queue"),url:g.uploader,fileFilter:[],uploadOver:!1,filter:function r(e){var i=[],t=!1,l=u(g.fileTypeExts);if(""!=g.fileTypeExts&&"*.*"!=g.fileTypeExts&&null!=g.fileTypeExts&&"*.*;"!=g.fileTypeExts||(t=!0),0<l.length)for(var n=0,a=e.length;n<a;n++){var o=e[n];if(o.size>g.fileSizeLimit)g.siteFree?Fai.ing("免费版单个文件大小不超过"+g.fileSizeLimit/1024/1024+"MB，<a href='"+g.updateUrlViewRes+'\' target="_blank">点击了解各版本限制。</a>',!0):Fai.ing("单个文件不能超过"+g.fileSizeLimit/1024/1024+"MB",!0);else{var s=o.name;if(g.siteFree){if(z(s,".apk")){Fai.ing("上传失败：您的版本目前不支持上传apk文件。",!0);continue}if(z(s,".exe")){Fai.ing("上传失败：您的版本目前不支持上传exe文件。",!0);continue}if(z(s,".html")||z(s,".htm")){Fai.ing("上传失败：您的版本目前不支持上传html或htm文件。",!0);continue}}t?i.push(o):0<=b.inArray(o.name.split(".").pop().toLowerCase(),l)?i.push(o):Fai.ing("文件"+o.name+"类型不允许！",!0)}}return i},funSelect:function n(e){if(!g.onSelect||g.onSelect(e)){if(g.breakPoints)var i=this.funGetUploadedSize(e[0]);if(-1!=i){var t=(i/e[0].size*100).toFixed(2),l={status:"start",id:e[0].id,title:"准备上传.....",percent:t,size:e[0].size};S(l),g.breakPoints&&(S(l={status:"ing",id:e[0].id,title:"正在上传.....",percent:t}),this.funUploadFile(e[0]))}}else F.fileFilter=[]},onProgress:function p(e,i,t){var l=b("body").find("#progressWrap_"+e.id),n=i,a=l.attr("lastLoaded")||0;(i-=parseInt(a))<0&&(i=0);var o=b("#progress"+e.id),s=g.breakPoints?parseFloat(o.attr("width")):0;if(!(i<e.size)){var r=parseFloat(o.attr("old-loaded")||s/100*t)+e.size;o.attr("old-loaded",r);var d=(r/t*100).toFixed(0);d=100<=d?100:d,n<g.fileSplitSize?l.attr("lastLoaded",n):l.removeAttr("lastLoaded"),tmpoptions={status:"ing",id:e.id,title:"正在上传.....",percent:d},S(tmpoptions)}},funGetProgressWidth:function t(e){},funGetUploadedSize:function l(e){return g.getUploadedSize?g.getUploadedSize(e):g.saveInfoLocal?parseInt(localStorage.getItem(e.name))||0:void 0},funSaveUploadedSize:function a(e,i){g.saveUploadedSize?g.saveUploadedSize(e,i):g.saveInfoLocal&&localStorage.setItem(e.name,i)},funGetFiles:function o(e){for(var i=e.target.files,t=0,l=(i=this.filter(i)).length;t<l;t++)this.fileFilter.push(i[t]);if(0!=this.fileFilter.length)return this.funDealFiles(i),this;b(this.fileInput).val("")},funDealFiles:function s(e){for(var i=b(document).find(".uploadify-queue .uploadify-queue-item").length,t=0,l=e.length;t<l;t++)e[t].index=++i,e[t].id="fileupload_"+c+"_"+e[t].index,e[t].md5=b.md5(e[t].name+e[t].size+e[t].type+e[t].lastModified),g.isBurst&&(0<=e[t].size&&e[t].size<20971520?g.fileSplitSize=5242880:20971520<=e[t].size&&e[t].size<52428800?g.fileSplitSize=5242880:52428800<=e[t].size&&e[t].size<104857600?g.fileSplitSize=8388608:104857600<=e[t].size&&e[t].size<524288e3?g.fileSplitSize=10485760:g.fileSplitSize=15728640);return this.funSelect(e),this},funDeleteFile:function d(e){for(var i=0,t=this.fileFilter.length;i<t;i++){var l=this.fileFilter[i];if(l.index==e){g.breakPoints&&(this.uploadAllowed=!1),this.fileFilter.splice(i,1),b(document).find("#fileupload_"+c+"_"+e).fadeOut(),F.fileInput.val(""),g.onCancel&&g.onCancel(l);break}}return this},funUploadFile:function m(i){F.xhr=new XMLHttpRequest;var t=i,l=!1,e=b(document).find("#fileupload_"+c+"_"+i.index),n=function n(){F.uploadOver&&(e.find(".uploadify-progress-bar").css("width","100%"),g.showUploadedSize&&e.find(".uploadedsize").text(e.find(".totalsize").text()),g.showUploadedPercent&&e.find(".up_percent").text("100%"),g.onUploadSuccess&&g.onUploadSuccess(t,F.xhr.responseText),F.funDeleteFile(i.index),setTimeout(a,1500))},a=function a(){if(0!=F.fileFilter.length){var e=F.funGetUploadedSize(F.fileFilter[0])/F.fileFilter[0].size*100,i={status:"start",id:F.fileFilter[0].id,title:"准备上传.....",percent:e,size:F.fileFilter[0].size};S(i),S(i={status:"ing",id:F.fileFilter[0].id,title:"正在上传.....",percent:e}),F.funUploadFile(F.fileFilter[0])}};try{F.xhr=new XMLHttpRequest}catch(u){F.xhr=ActiveXobject("Msxml12.XMLHTTP")}if(g.breakPoints){var o=i.name,s=i.id,r=i.index,d=i.size,p=i.md5,f=parseInt(this.funGetUploadedSize(t));d>=g.fileSplitSize?(i=t.slice(f,f+g.fileSplitSize),l=!1,F.lastSplit=!1):(l=!0,F.lastSplit=!0),i.name=o,i.id=s,i.index=r,i.md5=p}F.xhr.upload&&!1!==f&&(F.xhr.upload.addEventListener("progress",function(e){F.onProgress(i,e.loaded,t.size)},!1),F.xhr.onreadystatechange=function(){if(4==F.xhr.readyState){if(F.uploadOver=!0,200==F.xhr.status){var e=JSON.parse(F.xhr.responseText);if(e.success)g.breakPoints?(f+=g.fileSplitSize,F.funSaveUploadedSize(t,d<=f?d:f),f<d?(F.uploadOver=!1,F.uploadAllowed&&(l=f+g.fileSplitSize>=d?(i=t.slice(f,d),!0):(i=t.slice(f,f+g.fileSplitSize),!1),i.name=o,i.id=s,i.index=r,i.size=d,g.formData.fileMd5=t.md5,g.formData.totalSize=t.size,g.formData.complete=l,g.formData.initSize=f,setTimeout(h(F.url,F.xhr,i,g.formData),2e3))):n()):n();else Fai.ing("文件："+i.name+"  "+e.msg,!0),S({status:"end",id:i.id}),F.uploadOver=!0,n()}else F.uploadOver&&g.onUploadError&&g.onUploadError(t,F.xhr.responseText);F.uploadOver&&(g.onUploadComplete&&g.onUploadComplete(t,F.xhr.responseText),F.fileInput.val(""),x=90)}},g.onUploadStart&&g.onUploadStart(i),g.formData.fileMd5=i.md5,g.formData.totalSize=t.size,g.formData.complete=l,g.formData.initSize=f,F.uploadAllowed=!0,y(g.post_params),h(F.url,F.xhr,i,g.formData))},init:function f(){0<this.fileInput.length&&this.fileInput.change(function(e){F.funGetFiles(e)}),e.find(".uploadify-button").on("click",function(){e.find(".selectbtn").trigger("click")}),g.onInit&&g.onInit()}}).init()}),{genUploadUrl:y,stop:function d(){F.xhr.abort(),F.uploadOver=!1,F.uploadAllowed=!1;for(var e=0,i=F.fileFilter.length;e<i;e++)F.funDeleteFile(++e);F.fileFilter=[]},upload:function p(e){if("*"===e){var i=i=F.fileFilter.length,t=0;for(i=F.fileFilter.length;t<i;t++)F.funUploadFile(F.fileFilter[t])}else{var l=n(e,F.fileFilter);l&&F.funUploadFile(l)}},cancel:function f(e){if((e="*")==e)for(var i=0,t=F.fileFilter.length;i<t;i++)F.funDeleteFile(++i);else F.funDeleteFile(e)},disable:function c(e){b(e?"file_upload_"+e+"-button":"body").find(".uploadify-button").css("background-color","#888").off("click")},ennable:function m(e){var i=b(e?"file_upload_"+e+"-button":"body");i.find(".uploadify-button").css("background-color","#707070").on("click",function(){i.find(".selectbtn").trigger("click")})}}}}(jQuery);